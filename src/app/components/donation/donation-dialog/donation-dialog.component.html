<div class="w-full max-w-3xl">
  <div class="bg-blue-600 px-6 py-4">
    <h2 class="text-xl font-semibold text-white">
      {{ isEditMode ? 'Edit Donation' : 'Add New Donation' }}
    </h2>
  </div>
  
  <mat-dialog-content class="px-6 pb-6 bg-white">
    <div *ngIf="isLoadingMasterData" class="flex flex-col items-center justify-center py-12">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="mt-4 text-gray-600">Loading master data...</p>
    </div>

    <form [formGroup]="donationForm" (ngSubmit)="onSubmit()" *ngIf="!isLoadingMasterData" class="space-y-6 pt-6">
      <!-- Donor Information -->
      <div>
        <h3 class="text-base font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">Donor Information</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Donor Name</mat-label>
            <input matInput formControlName="donorName" placeholder="Enter donor name" required>
            <mat-error *ngIf="isFieldInvalid('donorName')">
              {{ getErrorMessage('donorName') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>PAN Number</mat-label>
            <input matInput formControlName="panNumber" placeholder="ABCDE1234F" maxlength="10">
            <mat-hint>Format: ABCDE1234F</mat-hint>
            <mat-error *ngIf="isFieldInvalid('panNumber')">
              {{ getErrorMessage('panNumber') }}
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Donor Address</mat-label>
          <textarea matInput formControlName="donorAddress" rows="2" placeholder="Enter donor address (optional)"></textarea>
        </mat-form-field>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Phone</mat-label>
            <input matInput formControlName="donorPhone" placeholder="Enter phone number">
            <mat-error *ngIf="isFieldInvalid('donorPhone')">
              {{ getErrorMessage('donorPhone') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="donorEmail" placeholder="Enter email address">
            <mat-error *ngIf="isFieldInvalid('donorEmail')">
              {{ getErrorMessage('donorEmail') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Donation Details -->
      <div>
        <h3 class="text-base font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">Donation Details</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Amount</mat-label>
            <input matInput type="number" formControlName="amount" placeholder="0.00" step="0.01" min="0.01" required>
            <mat-error *ngIf="isFieldInvalid('amount')">
              {{ getErrorMessage('amount') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Donation Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="donationDate" required>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="isFieldInvalid('donationDate')">
              {{ getErrorMessage('donationDate') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Payment Mode</mat-label>
            <mat-select formControlName="paymentModeId" required>
              <mat-option [value]="null">Select Payment Mode</mat-option>
              <mat-option *ngFor="let mode of paymentModes" [value]="mode.id">
                {{ mode.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="isFieldInvalid('paymentModeId')">
              {{ getErrorMessage('paymentModeId') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Purpose</mat-label>
            <mat-select formControlName="purposeId" required>
              <mat-option [value]="null">Select Purpose</mat-option>
              <mat-option *ngFor="let purpose of purposes" [value]="purpose.id">
                {{ purpose.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="isFieldInvalid('purposeId')">
              {{ getErrorMessage('purposeId') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Sub Category</mat-label>
            <mat-select formControlName="subCategoryId">
              <mat-option [value]="null">None</mat-option>
              <mat-option *ngFor="let subCat of subCategories" [value]="subCat.id">
                {{ subCat.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Event</mat-label>
            <mat-select formControlName="eventId">
              <mat-option [value]="null">None</mat-option>
              <mat-option *ngFor="let event of events" [value]="event.id">
                {{ event.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Branch</mat-label>
          <mat-select formControlName="branchId" required>
            <mat-option [value]="null">Select Branch</mat-option>
            <mat-option *ngFor="let branch of branches" [value]="branch.id">
              {{ branch.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="isFieldInvalid('branchId')">
            {{ getErrorMessage('branchId') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3" placeholder="Enter any additional notes (optional)"></textarea>
        </mat-form-field>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="px-6 py-4 border-t border-gray-200 bg-gray-50">
    <button 
      mat-button 
      (click)="onCancel()" 
      [disabled]="isSubmitting || isLoadingMasterData"
      class="mr-3">
      Cancel
    </button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()"
      [disabled]="isSubmitting || donationForm.invalid || isLoadingMasterData"
      class="flex items-center gap-2">
      <mat-spinner *ngIf="isSubmitting" diameter="20" class="button-spinner"></mat-spinner>
      <span *ngIf="!isSubmitting">{{ isEditMode ? 'Update' : 'Add' }}</span>
      <span *ngIf="isSubmitting">{{ isEditMode ? 'Updating...' : 'Adding...' }}</span>
    </button>
  </mat-dialog-actions>
</div>
